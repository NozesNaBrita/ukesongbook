angular.module('ukeSongbookApp', [
    'ngRoute',
    'ukeSongbookServices',
    'ukeSongbookControllers',
    'ukeSongbookDirectives',
    'duScroll'
])
    .config(['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {
        $routeProvider.
            when('/', {
                templateUrl: 'partials/main.html',
                controller: 'MainCtrl'
            })
            .when('/busca', {
                templateUrl: 'partials/search.html',
                controller: 'SearchCtrl'
            })
            .otherwise({redirectTo: '/'});

        // use the HTML5 History API
        //$locationProvider.html5Mode({
        //    enabled: true,
        //    requireBase: true
        //});
    }])
    .value('duScrollDuration', 1000)
    .run(['$rootScope', function($rootScope) {
        //$rootScope.$on("$routeChangeStart", function (event, next, current) {
        //    console.log(sessionStorage.restorestate);
        //    if (sessionStorage.restorestate == "true") {
        //        $rootScope.$broadcast('restorestate'); //let everything know we need to restore state
        //        sessionStorage.restorestate = false;
        //    }
        //});
        //
        //// "The onbeforeunload event fires when the document is about to be unloaded."
        //// http://www.w3schools.com/tags/ev_onbeforeunload.asp
        //window.onbeforeunload = function (event) {
        //    $rootScope.$broadcast('savestate');
        //};
    }]);





angular.module('ukeSongbookApp').run(['$templateCache', function($templateCache) {
  $templateCache.put('partials/search.html',
    '<br><br><div class="row"><div class="col-xs-12"><form id="song-search" name="formSongSearchTop" novalidate><div class="form-group"><input name="songSearchTop" class="form-control" focus-me-directive="focus === \'songSearchTop\'" required></div></form></div></div>');
}]);

/**
 * Created by thiago on 18/10/15.
 */
var ukeSongbookServices = angular.module('ukeSongbookServices', ['ngResource']);

ukeSongbookServices.factory('Poll', ['$resource', function($resource) {
        return $resource('http://dev.ukesongbook:3000/polls/:pollId', {}, {
            query: { method: 'GET', params: { pollId: 'polls' }, isArray: true }
        });
    }]);

ukeSongbookServices.factory('Song', ['$resource', function($resource) {
        return $resource('api/v1/songs/:songId', {}, {
            get: { method: 'GET', params: { songId: 'songId' }, isArray: false },
            list: { method: 'GET', isArray: true }
        });
    }]);


ukeSongbookServices.factory('reportRequestService', ['$rootScope', function ($rootScope) {
    var pristineModel = {
        person: {}
    };

    //var requestFormService = {
    return {
        model: angular.copy(pristineModel),
        // Futuro: guardar no sessionStorage
        //,
        //SaveState: function () {
        //    sessionStorage.requestFormService = angular.toJson(requestFormService.model);
        //},
        //RestoresState: function () {
        //    requestFormService.model = angular.fromJson(sessionStorage.requestFormService);
        //},
        clear: function () {
            //sessionStorage.clear();
            this.model = angular.copy(pristineModel);
        }
    };

    //$rootScope.$on("savestate", requestFormService.SaveState);
    //$rootScope.$on("restorestate", requestFormService.RestoresState);

    //return requestFormService;
}]);
angular.module('ukeSongbookApp').run(['$templateCache', function($templateCache) {
  $templateCache.put('partials/navbar.html',
    '<nav id="navbar-top" class="navbar navbar-default navbar-transparent"><div class="navbar-header"><a href="/" class="navbar-brand">O songbook do ukulele</a></div></nav>');
}]);

/**
 * Created by thiago on 17/10/15.
 */
var ukeSongbookDirectives = angular.module('ukeSongbookDirectives', []);

ukeSongbookDirectives.directive('navbarDirective', ['$document', function ($document) {
    return {
        restrict: 'E',
        templateUrl: 'partials/navbar.html'
    };
}]);

ukeSongbookDirectives.directive('footerDirective', ['$document', function ($document) {
    return {
        restrict: 'E',
        templateUrl: 'partials/footer.html'
    };
}]);

/**
 * Form attribute directives
 */
ukeSongbookDirectives.directive('numbersOnlyDirective', function(){
    return {
        restrict: 'A',
        require: 'ngModel',
        link: function(scope, element, attrs, modelCtrl) {
            modelCtrl.$parsers.push(function (inputValue) {
                // this next if is necessary for when using ng-required on your input.
                // In such cases, when a letter is typed first, this parser will be called
                // again, and the 2nd time, the value will be undefined
                if (inputValue === undefined) return '';
                inputValue = String(inputValue);
                var transformedInput = inputValue.replace(/[^0-9]/g, '');
                if (transformedInput!=inputValue) {
                    modelCtrl.$setViewValue(transformedInput);
                    modelCtrl.$render();
                }
                return transformedInput;
            });
        }
    };
});



ukeSongbookDirectives.directive('focusMeDirective', ['$timeout', function ($timeout) {
    return {
        scope: {
            trigger: '=focusMeDirective'
        },
        link: function (scope, element) {
            scope.$watch('trigger', function (value) {
                console.log(value);
                if (value === true) {
                    $timeout(function () {
                        element[0].focus();
                    });
                }
            });
        }
    };

}]);



angular.module('ukeSongbookApp').run(['$templateCache', function($templateCache) {
  $templateCache.put('partials/main.html',
    '<br><br><br><br><div class="row"><div class="col-xs-12"><form id="song-search" name="formSongSearch" novalidate><div class="form-group"><label for="songSearch">Música</label><input name="songSearch" class="form-control" id="songSearch" focus-me-directive="focus === \'songSearch\'" required></div><ul class="list-group"><li class="list-group-item" data-ng-repeat="song in songs" data-ng-click="voteFor(song)"><i data-ng-show="!song.voted" class="material-icons text-muted">&#xE87E;</i> <i data-ng-show="song.voted" class="material-icons voted">&#xE87D;</i> {{song.title}} - {{song.artist}}</li></ul></form></div></div>');
}]);

/**
 * Created by thiago on 16/10/15.
 */
var ukeSongbookControllers = angular.module('ukeSongbookControllers', []);

ukeSongbookControllers.controller('MainCtrl', ['$scope', '$document', 'Song',
    function($scope, $document, Song) {

        $scope.songs = Song.list(function(data){
            console.log(data);
        });

        $scope.voteFor = function(song) {
            try {
                song.voted = !song.voted;
            } catch(e) {
                song.voted = true;
            }
            if(song.voted === true) {
                // salvar voto
            }
        };


    }]);

ukeSongbookControllers.controller('SearchCtrl', ['$scope', '$document',
    function($scope, $document) {

    }]);
angular.module('ukeSongbookApp').run(['$templateCache', function($templateCache) {
  $templateCache.put('partials/footer.html',
    '<div class="row"><div class="col-xs-12"><h3>Compartilhe</h3><div class="addthis_sharing_toolbox"></div></div></div><div class="row" id="footer"><div class="col-xs-12"><section><h4>O songbook do ukulele</h4><a href="#">Termos de Uso</a></section><section style="font-size: 12px"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Licença Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"></a><br>O trabalho <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">O Songbook do Ukulele</span> está licenciado com uma Licença <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons - Atribuição-CompartilhaIgual 4.0 Internacional</a>.</section><section style="font-size: 12px">Criado com <i class="material-icons">&#xE87D;</i> por um baiano em Fortaleza.</section></div></div>');
}]);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInBhcnRpYWxzL3NlYXJjaC5qcyIsImpzL3NlcnZpY2VzLmpzIiwicGFydGlhbHMvbmF2YmFyLmpzIiwianMvZGlyZWN0aXZlcy5qcyIsInBhcnRpYWxzL21haW4uanMiLCJqcy9jb250cm9sbGVycy5qcyIsInBhcnRpYWxzL2Zvb3Rlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3VrZVNvbmdib29rQXBwJywgW1xuICAgICduZ1JvdXRlJyxcbiAgICAndWtlU29uZ2Jvb2tTZXJ2aWNlcycsXG4gICAgJ3VrZVNvbmdib29rQ29udHJvbGxlcnMnLFxuICAgICd1a2VTb25nYm9va0RpcmVjdGl2ZXMnLFxuICAgICdkdVNjcm9sbCdcbl0pXG4gICAgLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgICAgICAkcm91dGVQcm92aWRlci5cbiAgICAgICAgICAgIHdoZW4oJy8nLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9tYWluLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNYWluQ3RybCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2J1c2NhJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvc2VhcmNoLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTZWFyY2hDdHJsJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vdGhlcndpc2Uoe3JlZGlyZWN0VG86ICcvJ30pO1xuXG4gICAgICAgIC8vIHVzZSB0aGUgSFRNTDUgSGlzdG9yeSBBUElcbiAgICAgICAgLy8kbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoe1xuICAgICAgICAvLyAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAvLyAgICByZXF1aXJlQmFzZTogdHJ1ZVxuICAgICAgICAvL30pO1xuICAgIH1dKVxuICAgIC52YWx1ZSgnZHVTY3JvbGxEdXJhdGlvbicsIDEwMDApXG4gICAgLnJ1bihbJyRyb290U2NvcGUnLCBmdW5jdGlvbigkcm9vdFNjb3BlKSB7XG4gICAgICAgIC8vJHJvb3RTY29wZS4kb24oXCIkcm91dGVDaGFuZ2VTdGFydFwiLCBmdW5jdGlvbiAoZXZlbnQsIG5leHQsIGN1cnJlbnQpIHtcbiAgICAgICAgLy8gICAgY29uc29sZS5sb2coc2Vzc2lvblN0b3JhZ2UucmVzdG9yZXN0YXRlKTtcbiAgICAgICAgLy8gICAgaWYgKHNlc3Npb25TdG9yYWdlLnJlc3RvcmVzdGF0ZSA9PSBcInRydWVcIikge1xuICAgICAgICAvLyAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZXN0b3Jlc3RhdGUnKTsgLy9sZXQgZXZlcnl0aGluZyBrbm93IHdlIG5lZWQgdG8gcmVzdG9yZSBzdGF0ZVxuICAgICAgICAvLyAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVzdG9yZXN0YXRlID0gZmFsc2U7XG4gICAgICAgIC8vICAgIH1cbiAgICAgICAgLy99KTtcbiAgICAgICAgLy9cbiAgICAgICAgLy8vLyBcIlRoZSBvbmJlZm9yZXVubG9hZCBldmVudCBmaXJlcyB3aGVuIHRoZSBkb2N1bWVudCBpcyBhYm91dCB0byBiZSB1bmxvYWRlZC5cIlxuICAgICAgICAvLy8vIGh0dHA6Ly93d3cudzNzY2hvb2xzLmNvbS90YWdzL2V2X29uYmVmb3JldW5sb2FkLmFzcFxuICAgICAgICAvL3dpbmRvdy5vbmJlZm9yZXVubG9hZCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAvLyAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3NhdmVzdGF0ZScpO1xuICAgICAgICAvL307XG4gICAgfV0pO1xuXG5cblxuXG4iLCJhbmd1bGFyLm1vZHVsZSgndWtlU29uZ2Jvb2tBcHAnKS5ydW4oWyckdGVtcGxhdGVDYWNoZScsIGZ1bmN0aW9uKCR0ZW1wbGF0ZUNhY2hlKSB7XG4gICR0ZW1wbGF0ZUNhY2hlLnB1dCgncGFydGlhbHMvc2VhcmNoLmh0bWwnLFxuICAgICc8YnI+PGJyPjxkaXYgY2xhc3M9XCJyb3dcIj48ZGl2IGNsYXNzPVwiY29sLXhzLTEyXCI+PGZvcm0gaWQ9XCJzb25nLXNlYXJjaFwiIG5hbWU9XCJmb3JtU29uZ1NlYXJjaFRvcFwiIG5vdmFsaWRhdGU+PGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj48aW5wdXQgbmFtZT1cInNvbmdTZWFyY2hUb3BcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGZvY3VzLW1lLWRpcmVjdGl2ZT1cImZvY3VzID09PSBcXCdzb25nU2VhcmNoVG9wXFwnXCIgcmVxdWlyZWQ+PC9kaXY+PC9mb3JtPjwvZGl2PjwvZGl2PicpO1xufV0pO1xuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHRoaWFnbyBvbiAxOC8xMC8xNS5cbiAqL1xudmFyIHVrZVNvbmdib29rU2VydmljZXMgPSBhbmd1bGFyLm1vZHVsZSgndWtlU29uZ2Jvb2tTZXJ2aWNlcycsIFsnbmdSZXNvdXJjZSddKTtcblxudWtlU29uZ2Jvb2tTZXJ2aWNlcy5mYWN0b3J5KCdQb2xsJywgWyckcmVzb3VyY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuICRyZXNvdXJjZSgnaHR0cDovL2Rldi51a2Vzb25nYm9vazozMDAwL3BvbGxzLzpwb2xsSWQnLCB7fSwge1xuICAgICAgICAgICAgcXVlcnk6IHsgbWV0aG9kOiAnR0VUJywgcGFyYW1zOiB7IHBvbGxJZDogJ3BvbGxzJyB9LCBpc0FycmF5OiB0cnVlIH1cbiAgICAgICAgfSk7XG4gICAgfV0pO1xuXG51a2VTb25nYm9va1NlcnZpY2VzLmZhY3RvcnkoJ1NvbmcnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xuICAgICAgICByZXR1cm4gJHJlc291cmNlKCdhcGkvdjEvc29uZ3MvOnNvbmdJZCcsIHt9LCB7XG4gICAgICAgICAgICBnZXQ6IHsgbWV0aG9kOiAnR0VUJywgcGFyYW1zOiB7IHNvbmdJZDogJ3NvbmdJZCcgfSwgaXNBcnJheTogZmFsc2UgfSxcbiAgICAgICAgICAgIGxpc3Q6IHsgbWV0aG9kOiAnR0VUJywgaXNBcnJheTogdHJ1ZSB9XG4gICAgICAgIH0pO1xuICAgIH1dKTtcblxuXG51a2VTb25nYm9va1NlcnZpY2VzLmZhY3RvcnkoJ3JlcG9ydFJlcXVlc3RTZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcbiAgICB2YXIgcHJpc3RpbmVNb2RlbCA9IHtcbiAgICAgICAgcGVyc29uOiB7fVxuICAgIH07XG5cbiAgICAvL3ZhciByZXF1ZXN0Rm9ybVNlcnZpY2UgPSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbW9kZWw6IGFuZ3VsYXIuY29weShwcmlzdGluZU1vZGVsKSxcbiAgICAgICAgLy8gRnV0dXJvOiBndWFyZGFyIG5vIHNlc3Npb25TdG9yYWdlXG4gICAgICAgIC8vLFxuICAgICAgICAvL1NhdmVTdGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyAgICBzZXNzaW9uU3RvcmFnZS5yZXF1ZXN0Rm9ybVNlcnZpY2UgPSBhbmd1bGFyLnRvSnNvbihyZXF1ZXN0Rm9ybVNlcnZpY2UubW9kZWwpO1xuICAgICAgICAvL30sXG4gICAgICAgIC8vUmVzdG9yZXNTdGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyAgICByZXF1ZXN0Rm9ybVNlcnZpY2UubW9kZWwgPSBhbmd1bGFyLmZyb21Kc29uKHNlc3Npb25TdG9yYWdlLnJlcXVlc3RGb3JtU2VydmljZSk7XG4gICAgICAgIC8vfSxcbiAgICAgICAgY2xlYXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vc2Vzc2lvblN0b3JhZ2UuY2xlYXIoKTtcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSBhbmd1bGFyLmNvcHkocHJpc3RpbmVNb2RlbCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8kcm9vdFNjb3BlLiRvbihcInNhdmVzdGF0ZVwiLCByZXF1ZXN0Rm9ybVNlcnZpY2UuU2F2ZVN0YXRlKTtcbiAgICAvLyRyb290U2NvcGUuJG9uKFwicmVzdG9yZXN0YXRlXCIsIHJlcXVlc3RGb3JtU2VydmljZS5SZXN0b3Jlc1N0YXRlKTtcblxuICAgIC8vcmV0dXJuIHJlcXVlc3RGb3JtU2VydmljZTtcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgndWtlU29uZ2Jvb2tBcHAnKS5ydW4oWyckdGVtcGxhdGVDYWNoZScsIGZ1bmN0aW9uKCR0ZW1wbGF0ZUNhY2hlKSB7XG4gICR0ZW1wbGF0ZUNhY2hlLnB1dCgncGFydGlhbHMvbmF2YmFyLmh0bWwnLFxuICAgICc8bmF2IGlkPVwibmF2YmFyLXRvcFwiIGNsYXNzPVwibmF2YmFyIG5hdmJhci1kZWZhdWx0IG5hdmJhci10cmFuc3BhcmVudFwiPjxkaXYgY2xhc3M9XCJuYXZiYXItaGVhZGVyXCI+PGEgaHJlZj1cIi9cIiBjbGFzcz1cIm5hdmJhci1icmFuZFwiPk8gc29uZ2Jvb2sgZG8gdWt1bGVsZTwvYT48L2Rpdj48L25hdj4nKTtcbn1dKTtcbiIsIi8qKlxuICogQ3JlYXRlZCBieSB0aGlhZ28gb24gMTcvMTAvMTUuXG4gKi9cbnZhciB1a2VTb25nYm9va0RpcmVjdGl2ZXMgPSBhbmd1bGFyLm1vZHVsZSgndWtlU29uZ2Jvb2tEaXJlY3RpdmVzJywgW10pO1xuXG51a2VTb25nYm9va0RpcmVjdGl2ZXMuZGlyZWN0aXZlKCduYXZiYXJEaXJlY3RpdmUnLCBbJyRkb2N1bWVudCcsIGZ1bmN0aW9uICgkZG9jdW1lbnQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL25hdmJhci5odG1sJ1xuICAgIH07XG59XSk7XG5cbnVrZVNvbmdib29rRGlyZWN0aXZlcy5kaXJlY3RpdmUoJ2Zvb3RlckRpcmVjdGl2ZScsIFsnJGRvY3VtZW50JywgZnVuY3Rpb24gKCRkb2N1bWVudCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvZm9vdGVyLmh0bWwnXG4gICAgfTtcbn1dKTtcblxuLyoqXG4gKiBGb3JtIGF0dHJpYnV0ZSBkaXJlY3RpdmVzXG4gKi9cbnVrZVNvbmdib29rRGlyZWN0aXZlcy5kaXJlY3RpdmUoJ251bWJlcnNPbmx5RGlyZWN0aXZlJywgZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgbW9kZWxDdHJsKSB7XG4gICAgICAgICAgICBtb2RlbEN0cmwuJHBhcnNlcnMucHVzaChmdW5jdGlvbiAoaW5wdXRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIC8vIHRoaXMgbmV4dCBpZiBpcyBuZWNlc3NhcnkgZm9yIHdoZW4gdXNpbmcgbmctcmVxdWlyZWQgb24geW91ciBpbnB1dC5cbiAgICAgICAgICAgICAgICAvLyBJbiBzdWNoIGNhc2VzLCB3aGVuIGEgbGV0dGVyIGlzIHR5cGVkIGZpcnN0LCB0aGlzIHBhcnNlciB3aWxsIGJlIGNhbGxlZFxuICAgICAgICAgICAgICAgIC8vIGFnYWluLCBhbmQgdGhlIDJuZCB0aW1lLCB0aGUgdmFsdWUgd2lsbCBiZSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRWYWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gJyc7XG4gICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IFN0cmluZyhpbnB1dFZhbHVlKTtcbiAgICAgICAgICAgICAgICB2YXIgdHJhbnNmb3JtZWRJbnB1dCA9IGlucHV0VmFsdWUucmVwbGFjZSgvW14wLTldL2csICcnKTtcbiAgICAgICAgICAgICAgICBpZiAodHJhbnNmb3JtZWRJbnB1dCE9aW5wdXRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBtb2RlbEN0cmwuJHNldFZpZXdWYWx1ZSh0cmFuc2Zvcm1lZElucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWxDdHJsLiRyZW5kZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkSW5wdXQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59KTtcblxuXG5cbnVrZVNvbmdib29rRGlyZWN0aXZlcy5kaXJlY3RpdmUoJ2ZvY3VzTWVEaXJlY3RpdmUnLCBbJyR0aW1lb3V0JywgZnVuY3Rpb24gKCR0aW1lb3V0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIHRyaWdnZXI6ICc9Zm9jdXNNZURpcmVjdGl2ZSdcbiAgICAgICAgfSxcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3RyaWdnZXInLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG59XSk7XG5cblxuIiwiYW5ndWxhci5tb2R1bGUoJ3VrZVNvbmdib29rQXBwJykucnVuKFsnJHRlbXBsYXRlQ2FjaGUnLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkge1xuICAkdGVtcGxhdGVDYWNoZS5wdXQoJ3BhcnRpYWxzL21haW4uaHRtbCcsXG4gICAgJzxicj48YnI+PGJyPjxicj48ZGl2IGNsYXNzPVwicm93XCI+PGRpdiBjbGFzcz1cImNvbC14cy0xMlwiPjxmb3JtIGlkPVwic29uZy1zZWFyY2hcIiBuYW1lPVwiZm9ybVNvbmdTZWFyY2hcIiBub3ZhbGlkYXRlPjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+PGxhYmVsIGZvcj1cInNvbmdTZWFyY2hcIj5Nw7pzaWNhPC9sYWJlbD48aW5wdXQgbmFtZT1cInNvbmdTZWFyY2hcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwic29uZ1NlYXJjaFwiIGZvY3VzLW1lLWRpcmVjdGl2ZT1cImZvY3VzID09PSBcXCdzb25nU2VhcmNoXFwnXCIgcmVxdWlyZWQ+PC9kaXY+PHVsIGNsYXNzPVwibGlzdC1ncm91cFwiPjxsaSBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbVwiIGRhdGEtbmctcmVwZWF0PVwic29uZyBpbiBzb25nc1wiIGRhdGEtbmctY2xpY2s9XCJ2b3RlRm9yKHNvbmcpXCI+PGkgZGF0YS1uZy1zaG93PVwiIXNvbmcudm90ZWRcIiBjbGFzcz1cIm1hdGVyaWFsLWljb25zIHRleHQtbXV0ZWRcIj4mI3hFODdFOzwvaT4gPGkgZGF0YS1uZy1zaG93PVwic29uZy52b3RlZFwiIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnMgdm90ZWRcIj4mI3hFODdEOzwvaT4ge3tzb25nLnRpdGxlfX0gLSB7e3NvbmcuYXJ0aXN0fX08L2xpPjwvdWw+PC9mb3JtPjwvZGl2PjwvZGl2PicpO1xufV0pO1xuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHRoaWFnbyBvbiAxNi8xMC8xNS5cbiAqL1xudmFyIHVrZVNvbmdib29rQ29udHJvbGxlcnMgPSBhbmd1bGFyLm1vZHVsZSgndWtlU29uZ2Jvb2tDb250cm9sbGVycycsIFtdKTtcblxudWtlU29uZ2Jvb2tDb250cm9sbGVycy5jb250cm9sbGVyKCdNYWluQ3RybCcsIFsnJHNjb3BlJywgJyRkb2N1bWVudCcsICdTb25nJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRkb2N1bWVudCwgU29uZykge1xuXG4gICAgICAgICRzY29wZS5zb25ncyA9IFNvbmcubGlzdChmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUudm90ZUZvciA9IGZ1bmN0aW9uKHNvbmcpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgc29uZy52b3RlZCA9ICFzb25nLnZvdGVkO1xuICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICAgc29uZy52b3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzb25nLnZvdGVkID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgLy8gc2FsdmFyIHZvdG9cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuXG4gICAgfV0pO1xuXG51a2VTb25nYm9va0NvbnRyb2xsZXJzLmNvbnRyb2xsZXIoJ1NlYXJjaEN0cmwnLCBbJyRzY29wZScsICckZG9jdW1lbnQnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJGRvY3VtZW50KSB7XG5cbiAgICB9XSk7IiwiYW5ndWxhci5tb2R1bGUoJ3VrZVNvbmdib29rQXBwJykucnVuKFsnJHRlbXBsYXRlQ2FjaGUnLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkge1xuICAkdGVtcGxhdGVDYWNoZS5wdXQoJ3BhcnRpYWxzL2Zvb3Rlci5odG1sJyxcbiAgICAnPGRpdiBjbGFzcz1cInJvd1wiPjxkaXYgY2xhc3M9XCJjb2wteHMtMTJcIj48aDM+Q29tcGFydGlsaGU8L2gzPjxkaXYgY2xhc3M9XCJhZGR0aGlzX3NoYXJpbmdfdG9vbGJveFwiPjwvZGl2PjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9XCJyb3dcIiBpZD1cImZvb3RlclwiPjxkaXYgY2xhc3M9XCJjb2wteHMtMTJcIj48c2VjdGlvbj48aDQ+TyBzb25nYm9vayBkbyB1a3VsZWxlPC9oND48YSBocmVmPVwiI1wiPlRlcm1vcyBkZSBVc288L2E+PC9zZWN0aW9uPjxzZWN0aW9uIHN0eWxlPVwiZm9udC1zaXplOiAxMnB4XCI+PGEgcmVsPVwibGljZW5zZVwiIGhyZWY9XCJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS80LjAvXCI+PGltZyBhbHQ9XCJMaWNlbsOnYSBDcmVhdGl2ZSBDb21tb25zXCIgc3R5bGU9XCJib3JkZXItd2lkdGg6MFwiIHNyYz1cImh0dHBzOi8vaS5jcmVhdGl2ZWNvbW1vbnMub3JnL2wvYnktc2EvNC4wLzgweDE1LnBuZ1wiPjwvYT48YnI+TyB0cmFiYWxobyA8c3BhbiB4bWxuczpkY3Q9XCJodHRwOi8vcHVybC5vcmcvZGMvdGVybXMvXCIgcHJvcGVydHk9XCJkY3Q6dGl0bGVcIj5PIFNvbmdib29rIGRvIFVrdWxlbGU8L3NwYW4+IGVzdMOhIGxpY2VuY2lhZG8gY29tIHVtYSBMaWNlbsOnYSA8YSByZWw9XCJsaWNlbnNlXCIgaHJlZj1cImh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzQuMC9cIj5DcmVhdGl2ZSBDb21tb25zIC0gQXRyaWJ1acOnw6NvLUNvbXBhcnRpbGhhSWd1YWwgNC4wIEludGVybmFjaW9uYWw8L2E+Ljwvc2VjdGlvbj48c2VjdGlvbiBzdHlsZT1cImZvbnQtc2l6ZTogMTJweFwiPkNyaWFkbyBjb20gPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPiYjeEU4N0Q7PC9pPiBwb3IgdW0gYmFpYW5vIGVtIEZvcnRhbGV6YS48L3NlY3Rpb24+PC9kaXY+PC9kaXY+Jyk7XG59XSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
